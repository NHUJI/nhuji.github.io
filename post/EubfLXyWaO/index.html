<!DOCTYPE html>
<html>
  <head>
    <!-- 代码高亮 -->
    <link rel="stylesheet" type="text/css" href="https://nhuji.github.io/highlight/styles/github-dark.css">
    <script src="https://nhuji.github.io/highlight/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    
    <meta charset="utf-8" >
<meta name="msvalidate.01" content="A81BF2369C00030213C4032E982E497F" />

<title>iOS 密码自动填充介绍 | Huhu&#39;s blog</title>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DW92LC8QYB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-DW92LC8QYB');
</script>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<script src="https://kit.fontawesome.com/e8bf4d3f65.js" crossorigin="anonymous"></script>
<link rel="shortcut icon" href="https://nhuji.github.io/favicon.ico?v=1753943723267">
<link rel="stylesheet" href="https://nhuji.github.io/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="最近因为有需求, 调查了一下这方面的东西,所以整理一下 以便未来参考吧
首先 iOS 的密码填充从iOS 11 推出后到 13,基本完善了,后面密码方面再更新的都是用 &quot;Apple 登录&quot;, 第三方密码管理器之类的的东西..." />
    <meta name="keywords" content="" />
    
<!-- doodle彩蛋按钮 -->
    <style>
      button,
      button::after {
       padding: 16px 20px;
       font-size: 18px;
       background: linear-gradient(45deg, transparent 5%, #ff013c 5%);
       border: 0;
       color: #fff;
       letter-spacing: 3px;
       line-height: 1;
       box-shadow: 6px 0px 0px #00e6f6;
       outline: transparent;
       position: relative;
       /*display: flex;
       justify-content: center;
       align-items: center;*/
      }

      button::after {
       --slice-0: inset(50% 50% 50% 50%);
       --slice-1: inset(80% -6px 0 0);
       --slice-2: inset(50% -6px 30% 0);
       --slice-3: inset(10% -6px 85% 0);
       --slice-4: inset(40% -6px 43% 0);
       --slice-5: inset(80% -6px 5% 0);
       content: "HOVER ME";
       display: block;
       position: absolute;
       top: 0;
       left: 0;
       right: 0;
       bottom: 0;
       background: linear-gradient(45deg, transparent 3%, #00e6f6 3%, #00e6f6 5%, #ff013c 5%);
       text-shadow: -3px -3px 0px #f8f005, 3px 3px 0px #00e6f6;
       clip-path: var(--slice-0);
      }

      button:hover::after {
       animation: 1s glitch;
       animation-timing-function: steps(2, end);
      }

      @keyframes glitch {
       0% {
        clip-path: var(--slice-1);
        transform: translate(-20px, -10px);
       }

       10% {
        clip-path: var(--slice-3);
        transform: translate(10px, 10px);
       }

       20% {
        clip-path: var(--slice-1);
        transform: translate(-10px, 10px);
       }

       30% {
        clip-path: var(--slice-3);
        transform: translate(0px, 5px);
       }

       40% {
        clip-path: var(--slice-2);
        transform: translate(-5px, 0px);
       }

       50% {
        clip-path: var(--slice-3);
        transform: translate(5px, 0px);
       }

       60% {
        clip-path: var(--slice-4);
        transform: translate(5px, 10px);
       }

       70% {
        clip-path: var(--slice-2);
        transform: translate(-10px, 10px);
       }

       80% {
        clip-path: var(--slice-5);
        transform: translate(20px, -10px);
       }

       90% {
        clip-path: var(--slice-1);
        transform: translate(-10px, 0px);
       }

       100% {
        clip-path: var(--slice-1);
        transform: translate(0);
       }
      }

    </style>


  </head>

  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://nhuji.github.io">
      <!-- 头像 
        <img src="https://nhuji.github.io/images/avatar.png?v=1753943723267" class="site-logo">
      -->
        <div class="site-logo">
          <img src="https://nhuji.github.io/images/avatar2.png?v=1753943723267" class="site-logo-image-back">
          <img src="https://nhuji.github.io/images/avatar.png?v=1753943723267" class="site-logo-image">
        </div>
        <h1 class="site-title">Huhu&#39;s blog</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            首页
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            目录
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            标签
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            关于
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
          <a class="social-link" href="https://github.com/NHUJI" target="_blank">
            <i class="fa-brands fa-github"></i>
          </a>
        
      
        
      
        
      

      <a class="social-link" href="mailto:hujinfinite@gmail.com" target="_blank">
      <i class="fa-regular fa-envelope"></i>
      </a>

    </div>
    <div class="site-description">
      It's me, huhu
    </div>
    <div class="site-footer">
      <a href="https://github.com/NHUJI" target="_blank">© 2021~2025 Nhuji</a> | <a class="rss" href="https://nhuji.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">iOS 密码自动填充介绍</h2>
            <div class="post-date">2024-06-01</div>
            
            <div class="post-content" v-pre>
              <p>最近因为有需求, 调查了一下这方面的东西,所以整理一下 以便未来参考吧</p>
<p>首先 iOS 的密码填充从iOS 11 推出后到 13,基本完善了,后面密码方面再更新的都是用 &quot;Apple 登录&quot;, 第三方密码管理器之类的的东西了</p>
<p><img src="https://nhuji.github.io/post-images/1753848208319.png" alt="" loading="lazy"><br>
苹果将这个键盘上方的位置称为 QuickType bar, 这里除了密码推荐外还有可能推荐地址、联系人信息、验证码. (当然需要开发者设置UITextContentType为username, password, oneTimeCode, fullStreetAddress, email, telephoneNumber等)<br>
验证码的显示是由系统自动解析短信获得的,会在这个区域显示三分钟,或用户点击填充后消失</p>
<p>这次主要关注密码填充相关, 要在 App 中实现这样的一个自动推荐填充密码的功能我们可以把整个功能分为三步:</p>
<ol>
<li>
<p>建议新密码 (如果有注册流程)</p>
</li>
<li>
<p>保存密码</p>
</li>
<li>
<p>密码推荐</p>
</li>
</ol>
<p>但这些只要我们配置好了输入框的属性,那么我们就无需关注实现的细节</p>
<h1 id="与网站关联的配置">与网站关联的配置</h1>
<p>但实现这些功能有一个前提, 就是我们需要将 App 与网站进行关联, 与 Android可以以应用包名作为标示存储账号密码不同, iOS 的密码保存必须在有关联网站的情况下才可以进行, 以 Nintendo switch online 这个据说 ns 内置的App是 fenrir 开发 ,但手机版 App 我不知道是谁开发的应用为例, 它没有一个对应的网页, 所以使用了 accounts.nintendo.com 作为关联域(Associated Domains Entitlement) 来保存账号密码<br>
<img src="https://nhuji.github.io/post-images/1753848245779.png" alt="" loading="lazy"></p>
<p>我们要实现密码自动填充相关的功能也需要这样做,简单的说需要:</p>
<ul>
<li>添加相关域名</li>
</ul>
<p>在 Xcode 的 Project Navigator 中，选择你的应用目标，进入 &quot;Signing &amp; Capabilities&quot; 选项卡，添加 &quot;Associated Domains&quot; 的Capability。然后添加相关域名, 不要包含路径和query或尾部斜线&quot;/&quot;<br>
<img src="https://nhuji.github.io/post-images/1753848262034.png" alt="" loading="lazy"></p>
<ul>
<li>将关联域文件添加到网站上<br>
要将关联域文件添加到网站，需要创建一个名为 apple-app-site-association 的文件（无扩展名）并将其放置在网站的 . well-known 目录中. url 大概是这样的: <code>https://&lt;fully qualified domain&gt;/.well-known/apple-app-site-association</code></li>
</ul>
<p>通用链接, App Clip 相关的功能也会用到它</p>
<p>关联域文件的例子:</p>
<pre><code>{
  &quot;applinks&quot;: {
      &quot;details&quot;: [
           {
             &quot;appIDs&quot;: [ &quot;ABCDE12345.com.example.app&quot;, &quot;ABCDE12345.com.example.app2&quot; ],
             &quot;components&quot;: [
               {
                  &quot;#&quot;: &quot;no_universal_links&quot;,
                  &quot;exclude&quot;: true,
                  &quot;comment&quot;: &quot;Matches any URL with a fragment that equals no_universal_links and instructs the system not to open it as a universal link.&quot;
               },
               {
                  &quot;/&quot;: &quot;/buy/*&quot;,
                  &quot;comment&quot;: &quot;Matches any URL with a path that starts with /buy/.&quot;
               },
               {
                  &quot;/&quot;: &quot;/help/website/*&quot;,
                  &quot;exclude&quot;: true,
                  &quot;comment&quot;: &quot;Matches any URL with a path that starts with /help/website/ and instructs the system not to open it as a universal link.&quot;
               },
               {
                  &quot;/&quot;: &quot;/help/*&quot;,
                  &quot;?&quot;: { &quot;articleNumber&quot;: &quot;????&quot; },
                  &quot;comment&quot;: &quot;Matches any URL with a path that starts with /help/ and that has a query item with name 'articleNumber' and a value of exactly four characters.&quot;
               }
             ]
           }
       ]
   },
   &quot;webcredentials&quot;: {
      &quot;apps&quot;: [ &quot;ABCDE12345.com.example.app&quot; ]
   },


    &quot;appclips&quot;: {
        &quot;apps&quot;: [&quot;ABCED12345.com.example.MyApp.Clip&quot;]
    }
}
</code></pre>
<p>另外如果网站使用多个子域（如 example.com 、 www.example.com 和 support.example.com ），则每个子域都需要在 Associated Domains Entitlement 中有自己的条目，并且每个子域都必须有自己的 apple-app-site-association 文件</p>
<ul>
<li>系统验证并开启相关功能</li>
</ul>
<p>以上两步完成后,当 App 安装到设备上时,系统就会尝试下载解析该apple-app-site-association 文件,成功关联后密码填充相关的功能就可以用了.</p>
<p>另外以前是 APP 直接访问网站进行验证,而现在是苹果的 CDN 来进行这个验证,在开发App时，如果公共互联网无法访问网络服务器，\可以使用备用模式功能绕过 CDN，直接连接到专用域。可以通过在关联域的权限中添加查询字符串来启用备用模式: <code>&lt;service&gt;:&lt;fully qualified domain&gt;?mode=&lt;alternate mode&gt;</code></p>
<h1 id="qa">Q&amp;A</h1>
<ul>
<li>密码填充的功能的出现时机</li>
</ul>
<p>当用户在设备上至少存储过一个密码(不限定 app 或网站,也可能通过 iCloud 同步到设备上), 并在系统设置中打开了 Keychain AutoFill (系统设置→密码→密码选项), 那么 QuickType bar (也就是键盘上的密码区域) 就会出现, 并且可以通过钥匙图标进一步访问设备上存储的所有密码(不限 app)来选择填充</p>
<p>关闭掉Keychain AutoFill的话,无论怎么样都不会出现密码填充推荐和钥匙按钮了</p>
<p>另外在密码输入框时,只能使用系统提供的输入法, 不可以切换到第三方输入法, 因此即使用户使用第三方输入法也不会破坏该功能</p>
<ul>
<li>没有在APP内保存过账号密码时会出现吗</li>
</ul>
<p>就像之前说的,如果没有相关的密码保存,那么 QuickType bar 不会显示具体的账户信息,而是提供一个钥匙按钮,用户可以进入选择他认为合适的密码填充进 App 里</p>
<p>比如用户在各种网站都习惯用同一套密码,或者他手动存储了一套密码时都可以这样选择他认为合适的密码来填充</p>
<ul>
<li>在网页端保存过的账号密码，APP是否可以直接选择使用</li>
</ul>
<p>当 APP 有网页版时,只要我们按照上面所说的配置好关联域(可以配置多个网站)那么就会出现推荐来直接选择</p>
<p>以 Instagram ( Facebook旗下 App) 为例, 它可以填充来自用户在 Instagram.com 和 Facebook.com 网页中保存的密码<br>
<img src="https://nhuji.github.io/post-images/1753848314534.png" alt="" loading="lazy"></p>
<ul>
<li>使用第三方密码管理工具会不会影响该功能</li>
</ul>
<p>由于这种自动填充都是通过钥匙串 API 进行互动的, 我们不需要特别在意用户可能使用了什么第三方工具, 比如上面Instagram的例子中密码就是由 Chrome 的 Google 密码管理工具提供的账户密码, 在点击密码选择时也和系统原生操作一样.</p>
<ul>
<li>密码填充必须要验证吗?</li>
</ul>
<p>必须使用 face id 或 touch id 进行验证</p>
<ul>
<li>存储需要用 face id 等验证吗?</li>
</ul>
<p>不需要,确认需要保存就可以了<br>
<img src="https://nhuji.github.io/post-images/1753848328511.png" alt="" loading="lazy"></p>
<ul>
<li>flutter 中怎么实现呢</li>
</ul>
<p>具体请参考 <a href="https://api.flutter.dev/flutter/material/TextField/autofillHints.html">autofillHints property</a>  只要完成了上面原生也需要配置的东西,那么直接为输入框设置一些密码相关的属性就可以了</p>
<p>另外拿iOS-033测试机做实验时发现,最开始在各种 App 内均不会出现密码填充的 QuickType bar ,但关闭设置中的密码填充功能, 重启设备后再打开后成功出现了(果然重启解决一切,如果不行就重装 x). 因此如果以后测试时遇到了问题,不妨这样操作试试看</p>
<p>参考:<br>
<a href="https://developer.apple.com/documentation/security/password_autofill/">API Collection Password AutoFill</a></p>
<p><a href="https://developer.apple.com/documentation/security/password_autofill/about_the_password_autofill_workflow">About the Password AutoFill workflow</a></p>
<p><a href="https://developer.apple.com/documentation/bundleresources/entitlements/com_apple_developer_associated-domains">Associated Domains Entitlement</a></p>
<p><a href="https://developer.apple.com/documentation/xcode/supporting-associated-domains">Supporting associated domains</a></p>

            </div>
            
            
              <div class="next-post">
                <div class="next">下一篇</div>
                <a href="https://nhuji.github.io/post/hJE_oUR9wv/">
                  <h3 class="post-title">
                    iOS 隐私清单的 Q&amp;A
                  </h3>
                </a>
              </div>
            
            <!-- 像素图 -->
            
            <div id="doodle">
              <css-doodle  click-to-update >
                 @grid: 16x12 / 800px auto;
                  @size: 6px;
                  box-shadow: @m3x5(
                    calc(18px - @nx(-1) * 6px) calc(@ny * 6px)
                      0 @p(@m3(#000), @m2(transparent)),
                    calc(18px + @nx(-1) * 6px) calc(@ny * 6px)
                      0 @lp
                  );
              </css-doodle>
           
              <button onclick="startAnimation()">点击这里变得狂野</button>
            </div>

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>






   
    <script src="https://unpkg.com/css-doodle@0.34.1/css-doodle.min.js"></script>
     <!-- 用于判断css doodle的显示 -->
    <script>
      var doodle = document.getElementById("doodle");
      var pageTitle = document.title;
      if (pageTitle === "关于 | Huhu's blog") {
        doodle.style.display = 'block';
      } else {
        doodle.style.display = 'none';
      }
    </script>



    <!-- doodle更新 -->
    <script>
      const cssDoodle = document.querySelector('css-doodle');

      // 定义时间间隔变量，以毫秒为单位
      let interval = 2000;

      // 自动更新(播放)CSS-Doodle样式
      function animateDoodle() {
        cssDoodle.update();
        // 在10毫秒后再次调用此函数
        setTimeout(animateDoodle, interval);
      }
      
      function startAnimation() {
        interval /= 1.5;
        cssDoodle.update(`
         @grid: 16x12 / 800px auto;
         @size: 6px;
         color: hsl(@r240, 30%, 50%);
         box-shadow: @m3x5(
          calc(18px - @nx(-1) * 6px) calc(@ny * 6px)
            0 @p(@m3(currentColor), @m2(transparent)),
          calc(18px + @nx(-1) * 6px) calc(@ny * 6px)
            0 @lp
          );  
      `);
        // 开始快速更新动画
        animateDoodle();
      }


     
    </script>
  
  </body>
</html>
